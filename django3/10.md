# ç¬¬10ç«  é”¦ä¸Šæ·»èŠ±

æœ¬ç« ä¸­åŒ…å«å¦‚ä¸‹å°èŠ‚ï¼š

-   ä½¿ç”¨Django shell
-   ä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢è¡¨è¾¾å¼
-   slugify()çš„çŒ´å­è¡¥å­æ”¹è¿›å›½é™…åŒ–æ”¯æŒ
-   åˆ‡æ¢Debugå·¥å…·æ 
-   ä½¿ç”¨ThreadLocalMiddleware
-   ä½¿ç”¨ä¿¡å·æ¥é€šçŸ¥ç®¡ç†å‘˜æ–°æ¡ç›®
-   æ£€æµ‹ç¼ºå¤±çš„è®¾ç½®

## å¼•è¨€

æœ¬ç« ä¸­æˆ‘ä»¬ä¼šå­¦ä¹ ä¸€äº›é‡è¦çš„ç‚¹ç‚¹æ»´æ»´æ¥æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨Djangoã€‚è¿™é‡Œä¼šæ€»è§ˆå¦‚ä½•ä½¿ç”¨Django shellæ¥åœ¨æ–‡ä»¶ä¸­ç¼–å†™å‰è¿›è¡Œä»£ç çš„æµ‹è¯•ã€‚è¿˜ä¼šä»‹ç»çŒ´å­è¡¥ä¸ï¼Œä¹Ÿç§°â€œæ‚ç‰Œå†›è¡¥ä¸â€ï¼Œè¿™æ˜¯åƒPythonå’ŒRubyè¿™æ ·çš„åŠ¨æ€è¯­è¨€æ‰€å…·å¤‡çš„å¼ºå¤§ç‰¹æ€§ã€‚åŒæ—¶ä¼šè®¨è®ºå…¨æ–‡æœ¬æœç´¢çš„åŠŸèƒ½ï¼Œå¹¶ä¼šå­¦ä¹ åˆ°å¦‚ä½•è°ƒè¯•ä»£ç å¹¶æ£€æµ‹å…¶æ€§èƒ½ã€‚ç„¶åï¼Œæˆ‘ä»¬ä¼šå­¦ä¹ å¦‚ä½•è·å–ä»»æ„æ¨¡å—ä¸­ç™»å½•çš„ç”¨æˆ·ï¼ˆå’Œå…¶å®ƒè¯·æ±‚å‚æ•°ï¼‰ã€‚è¿˜ä¼šå­¦ä¹ åˆ°å¦‚ä½•å¤„ç†ä¿¡å·åŠåˆ›å»ºç³»ç»Ÿæ£€æµ‹ã€‚å‡†å¤‡å¼€å¯æœ‰è¶£çš„ç¼–ç¨‹ä½“éªŒä¹‹è¡Œå§ï¼

## æŠ€æœ¯è¦æ±‚

è¿è¡Œæœ¬ç« çš„ä»£ç è¦æ±‚å®‰è£…æœ€æ–°ç¨³å®šç‰ˆçš„Python 3ã€MySQLæˆ–PostgreSQLæ•°æ®åº“ä»¥åŠé€šè¿‡è™šæ‹Ÿç¯å¢ƒåˆ›å»ºçš„Djangoé¡¹ç›®ã€‚

å¯åœ¨[GitHubä»“åº“](https://github.com/alanhou/django3-cookbook)çš„Chapter10ç›®å½•ä¸­æŸ¥çœ‹æœ¬ç« çš„ä»£ç ã€‚

## ä½¿ç”¨Django shell

å¯ç”¨è™šæ‹Ÿç¯å¢ƒå¹¶è¿›å…¥å½“å‰é¡¹ç›®ç›®å½•ï¼Œåœ¨å‘½ä»¤è¡Œå·¥å…·ä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š

```
(env)$ python manage.py shell
```

é€šè¿‡æ‰§è¡Œä»¥ä¸Šå‘½ä»¤ï¼Œä¼šè¿›å…¥ä¸€ä¸ªäº¤äº’çš„Python shellï¼Œé…ç½®ä¸ºä½ çš„Djangoé¡¹ç›®ï¼Œåœ¨å…¶ä¸­å¯ä»¥å®æ—¶æ“ä½œä»£ç ã€æ£€æµ‹ç±»ã€æµ‹è¯•æ–¹æ³•æˆ–æ‰§è¡Œè„šæœ¬ã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ æ“ä½œDjango shellæ‰€éœ€äº†è§£çš„ä¸€äº›æœ€é‡è¦çš„åŠŸèƒ½ã€‚

### å‡†å¤‡å·¥ä½œ

å¯ä»¥å®‰è£…IPythonæˆ–bpythonæ¥å¯¹Python shellæä¾›æ›´å¤šçš„ç•Œé¢é€‰é¡¹ï¼Œä¹Ÿå¯ä»¥åŒæ—¶å®‰è£…è¿™ä¸¤è€…è¿›è¡Œé€‰æ‹©ã€‚å®ƒä»¬ä¼šåœ¨Django shellçš„è¾“å‡ºä¸­é«˜äº®è¯­æ³•æ˜¾ç¤ºï¼Œå¹¶ä¼šæ·»åŠ ä¸€äº›å¸®åŠ©ç±»ã€‚ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åœ¨è™šæ‹Ÿç¯å¢ƒä¸­è¿›è¡Œå®‰è£…ï¼š

```
(env)$ pip install ipython
(env)$ pip install bpython
```

### å¦‚ä½•å®ç°...

æŒ‰ç…§å¦‚ä¸‹å†…å®¹å­¦ä¹ ä½¿ç”¨Django shellçš„åŸºç¡€çŸ¥è¯†ï¼š

-   è¾“å…¥å¦‚ä¸‹å‘½ä»¤è¿è¡ŒDjango shellï¼š  


    ```
    (env)$ python manage.py shell
    ```

    å¦‚å·²å®‰è£…äº†IPythonæˆ–bpythonï¼Œé‚£ä¹ˆä¸ç®¡å®‰è£…çš„æ˜¯å“ªä¸ªï¼Œéƒ½ä¼šåœ¨è¿›å…¥shellæ—¶è‡ªåŠ¨å˜æˆé»˜è®¤ç•Œé¢ã€‚å¯ä»¥é€šè¿‡å¯¹ä¸Šè¿°å‘½ä»¤æ·»åŠ -i <interface>é€‰é¡¹æŒ‡å®šå…·ä½“çš„ç•Œé¢ã€‚æ ¹æ®æ‰€ä½¿ç”¨çš„ç•Œé¢æç¤ºç•Œé¢ä¼šä¸åŒã€‚ä¸‹å›¾æ˜¾ç¤ºIPythonçš„æ ·å­ï¼Œå‘½ä»¤è¡Œå‰é¢æ˜¯[1]:  
    TODO  
    å¦‚æœä½¿ç”¨bpythonï¼Œshellä¸­ä¼šæ˜¾ç¤º>>>å¼¹å‡ºæ¡†ï¼Œåœ¨ä»£ç ä¼šè¿›è¡Œé«˜äº®å¹¶ä¸”åœ¨è¾“å…¥æ—¶ä¼šæœ‰æ–‡æœ¬è‡ªåŠ¨å®ä¾‹ï¼Œå¦‚ä¸‹ï¼š  
    TODO  
    é»˜è®¤çš„Pythonç•Œé¢shellå¦‚ä¸‹ï¼ŒåŒæ ·åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨>>>ï¼Œä½†å‰é¢ä¼šæœ‰ä¸€æ®µæœ‰å…³ç³»ç»Ÿçš„ä¿¡æ¯ï¼š  
    TODO  
    ç°åœ¨å°±å¯ä»¥å¯¼å…¥ç±»ã€å‡½æ•°æˆ–å˜é‡ï¼Œå¹¶è¿›è¡Œå„ç±»æ“ä½œã€‚ä¾‹å¦‚ï¼ŒæŸ¥çœ‹ä¸€ä¸ªå·²å®‰è£…æ¨¡å—çš„ç‰ˆæœ¬ï¼Œå¯ä»¥å¯¼å…¥è¯¥æ¨¡å—ï¼Œç„¶åå°è¯•è¯»å–å…¶__version__ã€VERSIONæˆ–versionå±æ€§ï¼ˆä¸‹é¢ä½¿ç”¨bpythonå±•ç¤ºï¼ŒåŒæ—¶æ¼”ç¤ºäº†å…¶é«˜äº®å’Œè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼‰ï¼Œå¦‚ä¸‹ï¼š  
    TODO

-   è¦è·å–æ¨¡å—ã€ç±»ã€å‡½æ•°ã€æ–¹æ³•ã€å…³é”®å­—æˆ–æ–‡æ¡£ä¸»é¢˜çš„å…¨é¢æè¿°ï¼Œå¯ä½¿ç”¨help()å‡½æ•°ã€‚å¯ä»¥ä¼ é€’ä¸€ä¸ªåˆ°å…·ä½“å®ä½“çš„è·¯å¾„æˆ–å®ä½“æœ¬èº«å­—ç¬¦ä¸²ï¼Œå¦‚ä¸‹ï¼š  


    ```
    >>> help("django.forms")
    ```

    è¿™ä¼šæ‰“å¼€django.formsæ¨¡å—çš„å¸®åŠ©é¡µé¢ï¼Œä½¿ç”¨æ–¹å‘é”®ä¸Šä¸‹ç¿»å»é¡µé¢ã€‚æŒ‰ä¸‹Qå›åˆ°shellã€‚å¦‚æœè¿è¡Œhelp()å¹¶ä¸å¸¦å‚æ•°ï¼Œä¼šæ‰“å¼€äº¤äº’å¼å¸®åŠ©é¡µé¢ã€‚åœ¨å…¶ä¸­å¯è¾“å…¥è¯·æ³¨æ„æ¨¡å—è·¯å¾„ã€ç±»ã€å‡½æ•°ç­‰ï¼Œè·å–æœ‰å…³å…¶ä½œç”¨åŠå¦‚ä½•ä½¿ç”¨çš„ä¿¡æ¯ã€‚é€€å‡ºäº¤äº’å¸®åŠ©ç•Œé¢ï¼ŒæŒ‰Ctrl + Dã€‚

-   ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨IPythonä¸­å‘help()å‡½æ•°ä¼ é€’å®ä½“çš„ç¤ºä¾‹ï¼š  
    TODO  
    è¿™æ—¶ä¼šæ‰“å¼€ModelFormç±»çš„å¸®åŠ©é¡µé¢ï¼Œå¦‚ä¸‹ï¼š  
    TODO  
    å¿«é€ŸæŸ¥çœ‹åœ¨æ¨¡å‹å®ä¾‹ä¸­æœ‰å“ªäº›å­—æ®µå’Œå€¼å¯ä»¥ä½¿ç”¨ï¼Œä½¿ç”¨ __dict__å±æ€§ã€‚å¯ä»¥ä½¿ç”¨pprint()å‡½æ•°æ¥ä»¥å¯è¯»æ€§æ›´å¼ºçš„å½¢å¼æ‰“å°å­—å…¸ï¼ˆä¸æ˜¯ç®€å•çš„ä¸€é•¿è¡Œï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ³¨æ„åœ¨ä½¿ç”¨__dict__æ—¶ï¼Œä¸è·å–å¤šå¯¹å¤šå…³è”ï¼Œä½†è¶³å¤Ÿå¿«é€ŸæŸ¥çœ‹å­—æ®µå’Œå€¼äº†ï¼š  
    TODO

-   è·å–ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰å¯ç”¨å±æ€§å’Œæ–¹æ³•ï¼Œå¯ä½¿ç”¨dir()å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š  
    TODO

-   æ¯è¡Œæ‰“å°ä¸€ä¸ªå±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹å›¾ä¸­çš„ä»£ç ï¼š  
    TODO

-   Django shellå¯¹äºåœ¨å°†QuerySetæˆ–æ­£åˆ™è¡¨è¾¾å¼æ”¾å…¥æ¨¡å‹æ–¹æ³•ã€è§†å›¾æˆ–ç®¡ç†å‘½ä»¤å‰è¿›è¡Œç ”ç©¶å¾ˆæœ‰å¸®åŠ©ã€‚ä¾‹å¦‚ï¼Œè¦æ£€æµ‹emailéªŒè¯çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥åœ¨Django shellä¸­è¾“å…¥å¦‚ä¸‹ä»£ç ï¼š  


    ```
    >>> import re
    >>> email_pattern = re.compile(r"[^@]+@[^@]+.[^@]+") 
    >>> email_pattern.match("aidas@bendoraitis.lt") 
    <_sre.SRE_Match object at 0x1075681d0>
    ```

-   å¦‚æœå¸Œæœ›æµ‹è¯•ä¸åŒçš„æŸ¥è¯¢é›†ï¼Œä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š  


    ```
    >>> from django.contrib.auth.models import User 
    >>> User.objects.filter(groups__name="Editors") 
    [<User: admin>]
    ```

-   é€€å‡ºDjango shellï¼ŒæŒ‰ä¸‹Ctrl + Dæˆ–è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š  


    ```
    >>> exit()
    ```

### å®ç°åŸç†...

æ™®é€šPython shell å’Œ Django shellä¹‹é—´çš„åŒºåˆ«åœ¨äºåœ¨è¿è¡ŒDjango shellæ—¶ï¼Œmanage.pyè®¾ç½®çš„DJANGO_SETTINGS_MODULEè®©å…¶æŒ‡å‘é¡¹ç›®çš„settings.pyè·¯å¾„ï¼Œç„¶åDjango shellä¸­çš„æ‰€æœ‰ä»£ç éƒ½åœ¨é¡¹ç›®çš„ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œå¤„ç†ã€‚é€šè¿‡ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„IPythonæˆ–bpythonç•Œé¢ï¼Œå¯ä»¥è¿›ä¸€æ­¥çš„å¢å¼ºé»˜è®¤çš„Python shellï¼Œæ¯”å¦‚è¯­æ³•é«˜äº®ã€è‡ªåŠ¨è¡¥å…¨ç­‰ç­‰ã€‚

### ç›¸å…³å†…å®¹

-   *ä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢è¡¨è¾¾å¼*ä¸€èŠ‚
-   *slugify()çš„çŒ´å­è¡¥å­æ”¹è¿›å›½é™…åŒ–æ”¯æŒ*ä¸€èŠ‚

## ä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢è¡¨è¾¾å¼

Djangoå¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰å…·æœ‰ç‰¹æ®Šçš„æŠ½è±¡æ„é€ ï¼Œå¯ç”¨äºæ„å»ºå¤æ‚çš„æ•°æ®åº“æŸ¥è¯¢ã€‚ç§°ä¸ºæŸ¥è¯¢è¡¨è¾¾å¼ï¼Œè®©æˆ‘ä»¬å¯ä»¥è¿‡æ»¤æ•°æ®ã€æ’åºã€æ³¨è§£æ–°å­—æ®µåŠèšåˆå…³è”ç­‰ã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šå­¦ä¹ åœ¨å®é™…åœºæ™¯ä¸­å¦‚ä½•ä½¿ç”¨ã€‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ˜¾ç¤ºçˆ†æ¬¾è§†é¢‘çš„åº”ç”¨å¹¶è®¡ç®—æ¯ä¸ªè§†é¢‘è¢«åŒ¿åæˆ–ç™»å½•ç”¨æˆ·è§‚çœ‹çš„æ¬¡æ•°ã€‚

### å‡†å¤‡å·¥ä½œ

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªå¸¦æœ‰ViralVideoæ¨¡å‹çš„viral_videosåº”ç”¨å¹¶é…ç½®ç³»ç»Ÿæ¥è®©å…¶é»˜è®¤è‡ªåŠ¨è®°å½•å…¥æ—¥å¿—æ–‡ä»¶ï¼š

-   åˆ›å»ºviral_videosåº”ç”¨å¹¶å°†å…¶æ·»åŠ åˆ°é…ç½®æ–‡ä»¶çš„INSTALLED_APPSä¸­ï¼š  


    ```
    # myproject/settings/_base.py
    INSTALLED_APPS = [ 
        #...
        "myproject.apps.core",
        "myproject.apps.viral_videos",
    ]
    ```

-   ä¸ºçˆ†æ¬¾è§†é¢‘åˆ›å»ºä¸€ä¸ªæ¨¡å‹ï¼Œä¸»é”®ä¸ºä¸€ä¸ªé€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼ˆUUIDï¼‰ï¼Œå¹¶åŒ…å«åˆ›å»ºå’Œä¿®æ”¹æ—¶é—´æˆ³ã€æ ‡é¢˜ã€åµŒå…¥ä»£ç ã€åŒ¿åç”¨æˆ·è§‚çœ‹æ•°å’Œå·²ç™»å½•ç”¨è®°è§‚çœ‹æ•°ï¼Œå¦‚ä¸‹ï¼š  


    ```
    # myproject/apps/viral_videos/models.py
    import uuid
    from django.db import models
    from django.utils.translation import ugettext_lazy as _

    from myproject.apps.core.models import ( 
        CreationModificationDateBase, 
        UrlBase,
    )
    class ViralVideo(CreationModificationDateBase, UrlBase): 
        uuid = models.UUIDField(primary_key=True, default=None, editable=False)
        title = models.CharField(_("Title"), max_length=200, blank=True) 
        embed_code = models.TextField(_("YouTube embed code"), blank=True) 
        anonymous_views = models.PositiveIntegerField(
            _("Anonymous impressions"), default=0
        )
        authenticated_views = models.PositiveIntegerField( 
            _("Authenticated impressions"), default=0
        )

        class Meta:
            verbose_name = _("Viral video") 
            verbose_name_plural = _("Viral videos")
        
        def __str__(self): 
            return self.title

        def get_url_path(self):
            from django.urls import reverse

            return reverse("viral_videos:viral_video_detail", kwargs={"pk": self.pk})

        def save(self, *args, **kwargs): 
            if self.pk is None:
                self.pk = uuid.uuid4() 
            super().save(*args, **kwargs)
    ```

-   ä¸ºæ–°åº”ç”¨ç”Ÿæˆå¹¶è¿è¡Œè¿ç§»ï¼Œè¿™æ ·æ•°æ®åº“å°±å‡†å¤‡å°±ç»ªäº†ï¼š  


    ```
    (env)$ python manage.py makemigrations 
    (env)$ python manage.py migrate
    ```

-   å°†æ—¥å¿—é…ç½®åŠ å…¥åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼š  


    ```
    LOGGING = { 
        "version": 1,
        "disable_existing_loggers": False,
        "handlers": {
            "file": {
                "level": "DEBUG",
                "class": "logging.FileHandler",
                "filename": os.path.join(BASE_DIR, "tmp", "debug.log"),
            } 
        },
        "loggers": {"django": {"handlers": ["file"], "level": "DEBUG",
        "propagate": True}},
    }
    ```

è¿™ä¼šå°†è°ƒè¯•ä¿¡æ¯è®°å½•è‡³ä¸´æ—¶æ–‡ä»¶tmp/debug.logä¸­ã€‚

### å¦‚ä½•å®ç°...

ä¸ºè®²è§£æŸ¥è¯¢è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªçˆ†æ¬¾è§†é¢‘è¯¦æƒ…é¡µå¹¶å°†å…¶åŠ å…¥åˆ°URLé…ç½®ä¸­ï¼Œå¦‚ä¸‹ï¼š

1.  åœ¨views.pyä¸­åˆ›å»ºçˆ†æ¬¾è§†é¢‘åˆ—è¡¨å’Œè¯¦æƒ…è§†å›¾å¦‚ä¸‹ï¼š  


    ```
    # myproject/apps/viral_videos/views.py
    import logging

    from django.conf import settings
    from django.db import models
    from django.utils.timezone import now, timedelta
    from django.shortcuts import render, get_object_or_404 
    from django.views.generic import ListView

    from .models import ViralVideo

    POPULAR_FROM = getattr(settings, "VIRAL_VIDEOS_POPULAR_FROM", 500) 

    logger = logging.getLogger(__name__)

    class ViralVideoList(ListView):
        template_name = "viral_videos/viral_video_list.html" 
        model = ViralVideo

    def viral_video_detail(request, pk): 
        yesterday = now() - timedelta(days=1)

        qs = ViralVideo.objects.annotate( 
            total_views=models.F("authenticated_views") +
            models.F("anonymous_views"), 
            label=models.Case(
                models.When(total_views__gt=POPULAR_FROM, then=models.Value("popular")),
                models.When(created__gt=yesterday, then=models.Value("new")),
                default=models.Value("cool"),
                output_field=models.CharField(), 
            ),
        )
        # DEBUG: check the SQL query that Django ORM generates 
        logger.debug(f"Query: {qs.query}")
        
        qs = qs.filter(pk=pk)
        if request.user.is_authenticated:
            qs.update(authenticated_views=models.F("authenticated_views") + 1)
        else:
            qs.update(anonymous_views=models.F("anonymous_views") + 1)
        
        video = get_object_or_404(qs)
        
        return render(request, "viral_videos/viral_video_detail.html", {"video": video})
    ```

1.  ä¸ºè¯¥åº”ç”¨å®šä¹‰URLé…ç½®å¦‚ä¸‹ï¼š  


    ```
    # myproject/apps/viral_videos/urls.py
    from django.urls import path

    from .views import ViralVideoList, viral_video_detail 

    app_name = "viral_videos"

    urlpatterns = [
        path("", ViralVideoList.as_view(), name="viral_video_list"), 
        path("<uuid:pk>/", viral_video_detail, name="viral_video_detail"), 
    ]
    ```

1.  åœ¨é¡¹ç›®çš„é¡¶çº§URLé…ç½®æ–‡ä»¶ä¸­æ·»åŠ åº”ç”¨URLé…ç½®å¦‚ä¸‹ï¼š  


    ```
    # myproject/urls.py
    from django.conf.urls.i18n import i18n_patterns 
    from django.urls import include, path

    urlpatterns = i18n_patterns(
        path("viral-videos/", include("myproject.apps.viral_videos.urls", namespace="viral_videos")),
    )
    ```

1.  ä¸ºçˆ†æ¬¾è§†é¢‘åˆ—è¡¨è§†å›¾åˆ›å»ºæ¨¡æ¿å¦‚ä¸‹ï¼š  


    ```
    {# viral_videos/viral_video_list.html #}
    {% extends "base.html" %} 
    {% load i18n %}

    {% block content %}
        <h1>{% trans "Viral Videos" %}</h1>
        <ul>
            {% for video in object_list %}
                <li><a href="{{ video.get_url_path }}">{{ video.title }}</a></li> 
            {% endfor %}
        </ul>
    {% endblock %}
    ```

1.  ä¸ºçˆ†æ¬¾è§†é¢‘è¯¦æƒ…è§†å›¾åˆ›å»ºæ¨¡æ¿å¦‚ä¸‹ï¼š  


    ```
    {# viral_videos/viral_video_detail.html #}
    {% extends "base.html" %} 
    {% load i18n %}

    {% block content %} 
        <h1>{{ video.title }}
            <span class="badge">{{ video.label }}</span> 
        </h1>
        <div>{{ video.embed_code|safe }}</div> 
        <div>
            <h2>{% trans "Impressions" %}</h2>
            <ul>
                <li>{% trans "Authenticated views" %}:
                    {{ video.authenticated_views }}
                </li>
                <li>{% trans "Anonymous views" %}:
                    {{ video.anonymous_views }}
                </li>
                <li>{% trans "Total views" %}:
                    {{ video.total_views }}
                </li> 
            </ul>
        </div>
    {% endblock %}
    ```

1.  ä¸ºviral_videosåº”ç”¨é…ç½®åå°å¦‚ä¸‹ï¼Œå¹¶åœ¨å®Œæˆååœ¨æ•°æ®åº“ä¸­æ·»åŠ ä¸€äº›è§†é¢‘ï¼š  


    ```
    # myproject/apps/viral_videos/admin.py
    from django.contrib import admin
    from .models import ViralVideo

    @admin.register(ViralVideo)
    class ViralVideoAdmin(admin.ModelAdmin):
        list_display = ["title", "created", "modified"]
    ```

### å®ç°åŸç†...

ä½ å¯èƒ½æ³¨æ„åˆ°äº†è§†å›¾ä¸­çš„logger.debug()è¯­å¥ã€‚å¦‚æœä»¥DEBUGæ¨¡å¼è¿è¡ŒæœåŠ¡å¹¶åœ¨æµè§ˆå™¨ä¸­è®¿é—®è§†é¢‘ï¼ˆä¾‹å¦‚æœ¬åœ°å¼€å‘çš„ http://127.0.0.1:8000/en/viral-videos/2b14ffd3-d1f1-4699-a07b-1328421d8312/ï¼‰ï¼Œä¼šçœ‹åˆ°åœ¨æ—¥å¿—(tmp/debug.log)ä¸­æ‰“å°ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„SQLæŸ¥è¯¢ï¼š

```
SELECT "viral_videos_viralvideo"."created", 
"viral_videos_viralvideo"."modified", "viral_videos_viralvideo"."uuid", 
"viral_videos_viralvideo"."title", "viral_videos_viralvideo"."embed_code", 
"viral_videos_viralvideo"."anonymous_views", 
"viral_videos_viralvideo"."authenticated_views", 
("viral_videos_viralvideo"."authenticated_views" + 
"viral_videos_viralvideo"."anonymous_views") AS "total_views", CASE WHEN 
("viral_videos_viralvideo"."authenticated_views" + 
"viral_videos_viralvideo"."anonymous_views") > 500 THEN 'popular' WHEN 
"viral_videos_viralvideo"."created" > 
'2019-12-21T05:01:58.775441+00:00'::timestamptz THEN 'new' ELSE 'cool' END
AS "label" 
FROM "viral_videos_viralvideo" WHERE 
"viral_videos_viralvideo"."uuid" = '2b14ffd3-d1f1-4699-a07b-1328421d8312'::uuid LIMIT 21; 
args=(500, 'popular', datetime.datetime(2019, 12, 21, 5, 1, 58, 775441, tzinfo=<UTC>), 
'new', 'cool', UUID('2b14ffd3-d1f1-4699-a07b-1328421d8312'))
```

ç„¶ååœ¨æµè§ˆå™¨ä¸­å¯ä»¥çœ‹åˆ°æ˜¾ç¤ºå¦‚ä¸‹å†…å®¹çš„ç®€å•é¡µé¢ï¼š

-   è§†é¢‘æ ‡é¢˜
-   è§†é¢‘æ ‡ç­¾
-   åµŒå…¥çš„è§†é¢‘
-   ç™»å½•å’ŒåŒ¿åç”¨æˆ·çš„æµè§ˆæ•°ä»¥åŠæ€»æµè§ˆæ•°

ç±»ä¼¼å¦‚ä¸‹å›¾ç‰‡ï¼š

TODO

DjangoæŸ¥è¯¢é›†ä¸­çš„annotate()æ–¹æ³•è®©æˆ‘ä»¬å¯ä»¥å¯¹ SELECT SQLè¯­å¥æ·»åŠ æ›´å¤šçš„å­—æ®µï¼Œå¹¶ä¸”å¯¹é€šè¿‡æŸ¥è¯¢é›†æ‰€è·å–çš„å¯¹è±¡å®æ—¶è¿›è¡Œå±æ€§çš„åˆ›å»ºã€‚å€ŸåŠ©models.F()æˆ‘ä»¬å¯ä»¥å¼•ç”¨æ‰€é€‰æ•°æ®è¡¨çš„ä¸åŒå­—æ®µå€¼ã€‚æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºtotal_viewså±æ€§ï¼Œå®ƒæ˜¯å·²ç™»å½•å’ŒåŒ¿åç”¨æˆ·æµè§ˆé‡çš„æ€»å’Œã€‚

é€šè¿‡models.Case() å’Œ models.When()ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒçš„æ¡ä»¶è¿”å›å€¼ã€‚ä½¿ç”¨models.Value()æ¥æ ‡è®°è¿™äº›å€¼ã€‚æœ¬ä¾‹ä¸­æˆ‘ä»¬å°†åˆ›å»ºSQLæŸ¥è¯¢çš„labelå­—æ®µä»¥åŠç”±QuerySetæ‰€è¿”å›çš„å¯¹è±¡å±æ€§ã€‚å¦‚æœæµè§ˆé‡å¤§äº500åˆ™ä¼šè®¾ç½®ä¸ºpopularï¼Œè‹¥åœ¨24å°æ—¶ä¹‹å†…åˆ›å»ºåˆ™è®¾ç½®ä¸ºnewï¼Œå…¶å®ƒæƒ…å†µä¸ºcoolã€‚

åœ¨è§†å›¾çš„æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨äº†qs.update()æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•æ ¹æ®æµè§ˆè§†é¢‘çš„ç”¨æˆ·æ˜¯å¦ç™»å½•å¢åŠ å½“å‰è§†é¢‘çš„authenticated_viewså’Œanonymous_viewsã€‚è¿™ä¸€å¢é•¿ä¸æ˜¯åœ¨Pythonå±‚é¢ï¼Œè€Œæ˜¯åœ¨SQLå±‚é¢ã€‚è¿™è§£å†³äº†æ‰€è°“ç«æ€æ¡ä»¶çš„é—®é¢˜ï¼Œå³ä¸¤ä¸ªè®¿å®¢åŒæ—¶ä½¿ç”¨è¯¥è§†å›¾ï¼ŒåˆåŒæ­¥å¢é•¿è§†é¢‘æµè§ˆé‡ã€‚

### ç›¸å…³å†…å®¹

-   *ä½¿ç”¨Django shell*ä¸€èŠ‚
-   [**ç¬¬2ç«  æ¨¡å‹å’Œæ•°æ®åº“ç»“æ„**](https://alanhou.org/models-database-structure/)ä¸­çš„*é€šè¿‡URLç›¸å…³çš„æ–¹æ³•åˆ›å»ºæ¨¡å‹mixin*ä¸€èŠ‚
-   [**ç¬¬2ç«  æ¨¡å‹å’Œæ•°æ®åº“ç»“æ„**](https://alanhou.org/models-database-structure/)ä¸­çš„*åˆ›å»ºæ¨¡å‹mixinæ¥å¤„ç†åˆ›å»ºå’Œå˜æ›´æ—¥æœŸ*ä¸€èŠ‚

## slugify()çš„çŒ´å­è¡¥å­æ”¹è¿›å›½é™…åŒ–æ”¯æŒ

çŒ´å­è¡¥ä¸ï¼ˆæˆ–ç§°æ‚ç‰Œå†›è¡¥ä¸ï¼‰æ˜¯åœ¨è¿è¡Œæ—¶æ‰©å±•æˆ–ä¿®æ”¹å…¶å®ƒä»£ç çš„ä¸€æ®µä»£ç ã€‚ä¸æ¨èç»å¸¸ä½¿ç”¨çŒ´å­è¡¥ä¸ï¼Œæœ‰æ—¶åœ¨ä¸åˆ›å»ºæ¨¡å—çš„å•ç‹¬åˆ†æ”¯çš„æƒ…å†µä¸‹è¿™æ˜¯ä¿®æ”¹å¤æ‚ç¬¬ä¸‰æ–¹æ¨¡å—ä¸­bugçš„å”¯ä¸€é€”å¾„ã€‚åŒæ—¶ï¼ŒçŒ´å­è¡¥ä¸è¿˜å¯ç”¨äºåœ¨ä¸ä½¿ç”¨å¤æ‚åŠè€—æ—¶çš„æ•°æ®åº“æˆ–æ–‡ä»¶æ“ä½œçš„æƒ…å†µä¸‹ï¼Œè¿›è¡ŒåŠŸèƒ½æˆ–å•å…ƒæµ‹è¯•ã€‚

æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å°†é»˜è®¤çš„slugify()å‡½æ•°æ›¿æ¢ä¸ºç¬¬ä¸‰æ–¹è½¬è¯‘åŒ…ä¸­çš„é‚£ä¸ªï¼Œå®ƒæ›´æ™ºèƒ½åœ°å¤„ç†äº†Unicodeå­—ç¬¦å‘ASCIIå¯¹åº”å­—ç¬¦çš„è½¬åŒ–å¹¶åŒ…å«å¾ˆå¤šè¯­è¨€åŒ…ï¼Œç”šè‡³åœ¨éœ€è¦æ—¶è¿˜æœ‰æ›´å¤šçš„å…·ä½“è½¬æ¢ã€‚å¿«é€Ÿæé†’ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨slugify() æ¥ç”¨å¯¹è±¡æ ‡é¢˜æˆ–ä¸Šä¼ çš„æ–‡ä»¶ååˆ›å»ºå¯¹ç”¨æˆ·æ›´å‹å¥½çš„ç‰ˆæœ¬ã€‚åœ¨å¤„ç†æ—¶ï¼Œè¯¥å‡½æ•°å»é™¤å‰åç©ºæ ¼ï¼Œå°†æ–‡æœ¬è½¬åŒ–ä¸ºå°å†™ï¼Œåˆ é™¤éå­—æ¯æ•°å­—å­—ç¬¦ï¼Œå¹¶å°†ç©ºæ ¼è½¬åŒ–ä¸ºä¸­é—´æ ã€‚

### å‡†å¤‡å·¥ä½œ

æ‰§è¡Œå¦‚ä¸‹çš„å°æ­¥éª¤ï¼š

1.  åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…transliterateå¦‚ä¸‹ï¼š  


    ```
    (env)$ pip install transliterate==1.10.2
    ```

1.  ç„¶ååœ¨é¡¹ç›®ä¸­åˆ›å»ºguerrilla_patchesåº”ç”¨å¹¶æ·»åŠ åˆ°é…ç½®æ–‡ä»¶çš„INSTALLED_APPSä¸­ã€‚

### å¦‚ä½•å®ç°...

åœ¨guerrilla_patchesåº”ç”¨çš„models.pyæ–‡ä»¶ä¸­ï¼Œä½¿ç”¨transliterateåŒ…ä¸­çš„slugifyå‡½æ•°é‡å†™django.utils.textä¸­çš„é‚£ä¸ªï¼š

```
# myproject/apps/guerrilla_patches/models.py
from django.utils import text 
from transliterate import slugify

text.slugify = slugify
```

### å®ç°åŸç†...

é»˜è®¤çš„Django slugify() å‡½æ•°å¯¹å¾·è¯­å˜éŸ³ç¬¦å·çš„å¤„ç†æœ‰è¯¯ã€‚æƒ³è¦æŸ¥çœ‹ï¼Œå¯ä»¥è¯•ç€å¯¹ä¸€ä¸ªå¸¦æ‰€èƒ¡å¾·è¯­å˜éŸ³ç¬¦å·çš„é•¿è¯è¿›è¡Œurl è½¬æ¢ã€‚é¦–å…ˆåœ¨Django shellä¸­è¿è¡Œå¦‚ä¸‹æœªæ‰“çŒ´å­è¡¥ä¸çš„ä»£ç ï¼š

```
(env)$ python manage.py shell
>>> from django.utils.text import slugify 
>>> slugify("HeizÃ¶lrÃ¼ckstoÃŸabdÃ¤mpfung") 
'heizolruckstoabdampfung'
```

è¿™åœ¨å¾·è¯­ä¸­æ˜¯ä¸æ­£ç¡®çš„ï¼Œå­—æ¯ÃŸå®Œå…¨è¢«å»é™¤äº†è€Œæ²¡æœ‰ç”¨ssè¿›è¡Œæ›¿æ¢ï¼Œè€Œå­—æ¯Ã¤ã€Ã¶å’ŒÃ¼è¢«è½¬æ¢æˆäº†aã€oå’Œuï¼Œå®é™…ä¸Šåº”è¯¥ç”±aeã€oeå’Œueæ¥è¿›è¡Œæ›¿æ¢ã€‚

æˆ‘ä»¬æ‰€åˆ›å»ºçš„çŒ´å­è¡¥å­åœ¨åˆå§‹åŒ–æ—¶åŠ è½½django.utils.textæ¨¡å—å¹¶å¯¹æ ¸å¿ƒçš„slugify()å‡½æ•°é‡æ–°èµ‹å€¼transliteration.slugifyã€‚è¿™æ—¶å¦‚ä½•åœ¨Django shellä¸­è¿è¡ŒåŒæ ·çš„ä»£ç ï¼Œä¼šå¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œå¦‚ä¸‹ï¼š

```
(env)$ python manage.py shell
>>> from django.utils.text import slugify
>>> slugify("HeizÃ¶lrÃ¼ckstoÃŸabdÃ¤mpfung") 
'heizoelrueckstossabdaempfung'
```

> â„¹ï¸ å‚è§https://pypi.org/project/transliterate/æ¥é˜…è¯»æ›´å¤šæœ‰å…³å¦‚ä½•ä½¿ç”¨transliterateæ¨¡å—çš„çŸ¥è¯†ã€‚

### æ‰©å±•çŸ¥è¯†...

åœ¨åˆ›å»ºçŒ´å­è¡¥ä¸ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®Œå…¨æ˜ç™½å¸Œæœ›ä¿®æ”¹åçš„ä»£ç å¦‚ä½•è¿è¡Œã€‚è¿™å¯é€šè¿‡åˆ†æå·²æœ‰ä»£ç å’ŒæŸ¥çœ‹å„ä¸ªå˜é‡çš„å€¼æ¥å®ç°ã€‚æœ‰ä¸€ä¸ªæœ‰ç”¨çš„å†…ç½®Pythonè°ƒè¯•å™¨æ¨¡å—pdbï¼Œå¯ä»¥ä¸´æ—¶æ·»åŠ åˆ°Djangoä»£ç ï¼ˆæˆ–ç¬¬ä¸‰æ–¹æ¨¡å—ï¼‰ä¸­æ¥åœ¨å¼€å‘æœåŠ¡å™¨ä¸Šåœ¨ä»»æ„æ–­ç‚¹å¤„åœæ­¢æ‰§è¡Œã€‚ä½¿ç”¨å¦‚ä¸‹ä»£ç æ¥è°ƒè¯•Pythonæ¨¡å—ä¸­ä¸æ¸…æ¥šéƒ¨åˆ†çš„ä»£ç ï¼š

```
breakpoint()
```

> ç›¸å…³æ–‡ç« ï¼š[Pythonè‡ªåŠ¨åŒ–è„šæœ¬-è¿ç»´äººå‘˜å®å…¸ç¬¬äºŒç«  Pythonè„šæœ¬è°ƒè¯•å’Œæ€§èƒ½æµ‹è¯•](https://alanhou.org/debugging-profiling-python-scripts/)

è¿™ä¼šå¯åŠ¨ä¸€ä¸ªäº¤äº’å¼shellï¼Œåœ¨å…¶ä¸­å¯ä»¥è¾“å…¥å˜é‡åæ¥æŸ¥çœ‹å€¼ã€‚å¦‚æœè¾“å…¥ c æˆ–continueï¼Œä»£ç ç»§æ‰¿æ‰§è¡Œç›´è‡³é‡åˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹ã€‚å¦‚æœè¾“å…¥q æˆ– quitï¼Œä¼šåœæ­¢ç®¡ç†å‘½ä»¤ã€‚

> â„¹ï¸å¯ä»¥é€šè¿‡https://docs.python.org/3/library/pdb.htmlå­¦ä¹ æ›´å¤šPythonè°ƒè¯•å™¨å‘½ä»¤ä»¥åŠå¦‚ä½•æŸ¥çœ‹ä»£ç å›æº¯è¿½è¸ªã€‚

å¦ä¸€ç§åœ¨å¼€å‘æœåŠ¡å™¨ä¸Šå¿«é€ŸæŸ¥çœ‹å˜é‡å€¼çš„æ–¹å¼æ˜¯ä»¥å˜é‡ä½œä¸ºæ¶ˆæ¯æŠ›å‡ºä¸€ä¸ªè­¦å‘Šï¼Œå¦‚ä¸‹ï¼š

```
raise Warning, some_variable
```

åœ¨å¤„äºDEBUGæ¨¡å¼æ—¶ï¼ŒDjangoæ—¥å¿—å™¨ä¼šä¸ºä½ æä¾›å›æº¯åŠå…¶å®ƒæœ¬åœ°å˜é‡ã€‚

> ğŸ’¡åœ¨å°†ä»£ç æäº¤åˆ°ä»“åº“å‰åˆ«å¿˜äº†è¦åˆ é™¤è°ƒè¯•ä»£ç ã€‚

å¦‚æœä½¿ç”¨PyCharmäº¤äº’å¼å¼€å‘ç¯å¢ƒï¼Œå¯ä»¥æ— éœ€ä¿®æ”¹æºä»£ç ç›´æ¥ç”¨å›¾å½¢åŒ–ç•Œé¢è®¾ç½®æ–­ç‚¹åŠè°ƒè¯•å˜é‡ã€‚

### ç›¸å…³å†…å®¹

-   *ä½¿ç”¨Django shell*ä¸€èŠ‚

## åˆ‡æ¢Debugå·¥å…·æ 

åœ¨ä½¿ç”¨Djangoè¿›è¡Œå¼€å‘æ—¶ï¼Œå¯èƒ½ä¼šå¸Œæœ›æŸ¥çœ‹è¯·æ±‚å¤´éƒ¨å’Œå‚æ•°ï¼Œæ£€æŸ¥å½“å‰æ¨¡æ¿ä¸Šä¸‹æ–‡ï¼Œæˆ–åº¦é‡SQLæŸ¥è¯¢çš„æ€§èƒ½ã€‚æ‰€æœ‰è¿™äº›å’Œæ›´å¤šåŠŸèƒ½éƒ½å¯é€šè¿‡Djangoè°ƒè¯•å·¥ä½œæ å®ç°ã€‚å®ƒæ˜¯ä¸€ä¸ªæ˜¾ç¤ºæœ‰å…³å½“å‰è¯·æ±‚å’Œå“åº”å„ç§è°ƒè¯•ä¿¡æ¯çš„å¯é…ç½®é¢æ¿é›†ã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è®²è§£å¦‚ä½•æ ¹æ®ç”±å°ä¹¦ç­¾è®¾ç½®çš„cookieå€¼åˆ‡æ¢è°ƒè¯•å·¥å…·æ çš„å¯è§æ€§ã€‚å°ä¹¦ç­¾æ˜¯ä¸€å°æ®µJavaScriptä»£ç çš„ä¹¦ç­¾ï¼Œå¯ä»¥åœ¨æµè§ˆçš„ä»»æ„é¡µé¢ä¸­è¿è¡Œã€‚

### å‡†å¤‡å·¥ä½œ

æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ¥åˆ‡æ¢è°ƒè¯•å·¥å…·æ çš„å¯è§æ€§ï¼š

1.  åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…Djangoè°ƒè¯•å·¥å…·æ ï¼š  


    ```
    (env)$ pip install django-debug-toolbar==2.1
    ```

1.  åœ¨é…ç½®æ–‡ä»¶çš„INSTALLED_APPSä¸­æ·»åŠ debug_toolbarï¼š  


    ```
    # myproject/settings/_base.py
    INSTALLED_APPS = [ 
        #...
        "debug_toolbar",
    ]
    ```

### å¦‚ä½•å®ç°...

æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ¥é…ç½®Djangoè°ƒè¯•å·¥å…·æ ï¼Œå¯ä½¿ç”¨æµè§ˆå™¨çš„å°æ ‡ç­¾æ¥è¿›è¡Œå¼€å…³ï¼š

1.  æ·»åŠ å¦‚ä¸‹é¡¹ç›®é…ç½®ï¼š  


    ```
    # myproject/settings/_base.py
    DEBUG_TOOLBAR_CONFIG = {
        "DISABLE_PANELS": [],
        "SHOW_TOOLBAR_CALLBACK": "myproject.apps.core.misc.custom_show_toolbar", 
        "SHOW_TEMPLATE_CONTEXT": True,
    }
    DEBUG_TOOLBAR_PANELS = [ 
        "debug_toolbar.panels.versions.VersionsPanel", 
        "debug_toolbar.panels.timer.TimerPanel", 
        "debug_toolbar.panels.settings.SettingsPanel", 
        "debug_toolbar.panels.headers.HeadersPanel", 
        "debug_toolbar.panels.request.RequestPanel", 
        "debug_toolbar.panels.sql.SQLPanel", 
        "debug_toolbar.panels.templates.TemplatesPanel", 
        "debug_toolbar.panels.staticfiles.StaticFilesPanel", 
        "debug_toolbar.panels.cache.CachePanel",
        "debug_toolbar.panels.signals.SignalsPanel", 
        "debug_toolbar.panels.logging.LoggingPanel", 
        "debug_toolbar.panels.redirects.RedirectsPanel",
    ]
    ```

1.  åœ¨coreåº”ç”¨ä¸­ï¼Œä½¿ç”¨custom_show_toolbar() å‡½æ•°åˆ›å»ºä¸€ä¸ªmisc.pyæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š  


    ```
    # myproject/apps/core/misc.py
    def custom_show_toolbar(request):
        return "1" == request.COOKIES.get("DebugToolbar", False)
    ```

1.  åœ¨é¡¹ç›®çš„urls.pyä¸­æ·»åŠ å¦‚ä¸‹é…ç½®è§„åˆ™ï¼š  


    ```
    # myproject/urls.py
    from django.conf.urls.i18n import i18n_patterns 
    from django.urls import include, path
    from django.conf import settings
    import debug_toolbar

    urlpatterns = i18n_patterns( 
        #...
    )
    urlpatterns = [
        path('__debug__/', include(debug_toolbar.urls)),
    ] + urlpatterns
    ```

1.  æ‰“å¼€Chromeæˆ–Firefoxæµè§ˆå™¨å¹¶è¿›å…¥ä¹¦ç­¾ç®¡ç†å™¨ã€‚ç„¶åï¼Œæ–°å»ºåŒ…å«JavaScriptçš„ä¸¤ä¸ªä¹¦ç­¾ã€‚ç¬¬ä¸€ä¸ªæ€¥æ‹‰æ˜¾ç¤ºå·¥å…·æ ï¼Œç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š  
    TODO  
    JavaScriptä»£ç å¦‚ä¸‹ï¼š

    ```
    javascript:(function(){document.cookie="DebugToolbar=1;
    path=/";location.reload();})();
    ```

1.  ç¬¬äºŒæ®µJavaScripté“¾æ¥ä¼šéšè—å·¥å…·æ ï¼Œæ•ˆæœç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š  
    TODO  
    å®Œæ•´çš„JavaScriptä»£ç å¦‚ä¸‹ï¼š

    ```
    javascript:(function(){document.cookie="DebugToolbar=0;
    path=/";location.reload();})();
    ```

### å®ç°åŸç†...

DEBUG_TOOLBAR_PANELSé…ç½®å®šä¹‰åœ¨å·¥å…·æ ä¸­æ˜¾ç¤ºçš„é¢æ¿ã€‚DEBUG_TOOLBAR_CONFIGå­—å…¸å®šä¹‰å·¥å…·æ çš„é…ç½®ï¼ŒåŒ…å«ç”¨äºæŸ¥çœ‹æ˜¯å¦æ˜¾ç¤ºå·¥å…·æ ·æ¬¾çš„å‡½æ•°çš„è·¯å¾„ã€‚

é»˜è®¤ï¼Œåœ¨æµè§ˆé¡¹ç›®æ—¶ï¼Œä¸ä¼šæ˜¾ç¤ºDjangoè°ƒè¯•å·¥å…·æ ï¼Œä½†åœ¨ç‚¹å‡»Debug Toolbar Onå°ä¹¦ç­¾æ—¶ï¼ŒDebugToolbarçš„cookieä¼šè®¾ç½®ä¸º1ï¼Œé¡µé¢ä¼šè¿›è¡Œåˆ·æ–° ï¼Œå°±ä¼šçœ‹åˆ°å¸¦æœ‰è°ƒè¯•é¢æ¿çš„å·¥å…·æ ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹SQLè¯­å¥çš„æ€§èƒ½ä»¥ä¾›ä¼˜åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

TODO

è¿˜èƒ½å¤ŸæŸ¥çœ‹å½“å‰è§†å›¾çš„æ¨¡æ¿ä¸Šä¸‹æ–‡å˜é‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

TODO

ç‚¹å‡»ç¬¬äºŒä¸ªå°ä¹¦ç­¾Debug Toolbar Offï¼Œç›¸åº”åœ°ä¼šå°†DebugToolbarçš„è®¾ç½®ä¸º0å¹¶åˆ·æ–°é¡µé¢ï¼Œå†æ¬¡éšè—å·¥å…·æ ã€‚

### ç›¸å…³å†…å®¹

-   [**ç¬¬13ç«  ç»´æŠ¤**](https://alanhou.org/django3-maintenance/)ä¸­çš„*é€šè¿‡emailè·å–è¯¦ç»†é”™è¯¯æŠ¥å‘Š*ä¸€èŠ‚

## ä½¿ç”¨ThreadLocalMiddleware

HttpRequestå¯¹è±¡åŒ…å«æœ‰å…³å½“å‰ç”¨æˆ·ã€è¯­è¨€ã€æœåŠ¡ç«¯å˜é‡ã€cookieã€sessionç­‰æœ‰ç”¨ä¿¡æ¯ã€‚äº‹å®ä¸ŠHttpRequeståœ¨è§†å›¾å’Œmiddlewareä¸­è¿›è¡Œæä¾›ï¼Œå¯ä»¥å°†å…¶ï¼ˆæˆ–å…¶å±æ€§å€¼ï¼‰ä¼ é€’ç»™è¡¨å•ã€æ¨¡å‹æ–¹æ³•ã€æ¨¡å‹ç®¡ç†å™¨å’Œæ¨¡æ¿ç­‰ç­‰ã€‚è¦è¿›è¡Œç®€åŒ–ï¼Œå¯ä»¥ä½¿ç”¨æ‰€è°“çš„ThreadLocalMiddlewareï¼Œå®ƒåœ¨å…¨å±€å¯è®¿é—®çš„Pythonçº¿ç¨‹ä¸­å­˜å‚¨å½“å‰HttpRequestå¯¹è±¡ã€‚å› æ­¤ï¼Œå¯ä»¥åœ¨æ¨¡å‹æ–¹æ³•ã€è¡¨å•ã€ä¿¡å·å¤„ç†å™¨å’Œå…¶å®ƒé‚£äº›æ­¤å‰ä¸èƒ½ç›´æ¥è®¿é—®åˆ°HttpRequestå¯¹è±¡çš„åœ°æ–¹è®¿é—®å®ƒã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å®šä¹‰è¿™ä¸€ä¸­é—´ä»¶ã€‚

### å‡†å¤‡å·¥ä½œ

å¦‚æœªåˆ›å»ºï¼Œè¯·åˆ›å»ºcoreåº”ç”¨å¹¶å°†å…¶åŠ åˆ°é…ç½®æ–‡ä»¶çš„INSTALLED_APPSä¸­ã€‚

### å¦‚ä½•å®ç°...

æ‰§è¡Œå¦‚ä¸‹ä¸¤æ­¥æ¥é…ç½®ThreadLocalMiddlewareï¼Œå¯ç”¨äºåœ¨é¡¹ç›®ä»£ç çš„ä»»æ„å‡½æ•°æˆ–æ–¹æ³•ä¸­è·å–å½“å‰HttpRequestæˆ–ç”¨æˆ·ï¼š

1.  ä½¿ç”¨å¦‚ä¸‹å†…å®¹åœ¨coreåº”ç”¨ä¸­æ·»åŠ middleware.pyæ–‡ä»¶ï¼š  


    ```
    # myproject/apps/core/middleware.py
    from threading import local 

    _thread_locals = local()

    def get_current_request(): 
        """
        :returns the HttpRequest object for this thread
        """
        return getattr(_thread_locals, "request", None)

    def get_current_user(): 
        """
        :returns the current user if it exists or None otherwise """ 
        request = get_current_request()
        if request:
            return getattr(request, "user", None)


    class ThreadLocalMiddleware(object): 
        """
        Middleware to add the HttpRequest to thread local storage
        """

        def __init__(self, get_response): 
            self.get_response = get_response

        def __call__(self, request): 
            _thread_locals.request = request 
            return self.get_response(request)
    ```

1.  å°†è¯¥ä¸­é—´ä»¶æ·»åŠ åˆ°é…ç½®æ–‡ä»¶çš„MIDDLEWAREä¸­ï¼š  


    ```
    # myproject/settings/_base.py
    MIDDLEWARE = [ 
        "django.middleware.security.SecurityMiddleware", 
        "django.contrib.sessions.middleware.SessionMiddleware", 
        "django.middleware.common.CommonMiddleware", 
        "django.middleware.csrf.CsrfViewMiddleware", 
        "django.contrib.auth.middleware.AuthenticationMiddleware", 
        "django.contrib.messages.middleware.MessageMiddleware", 
        "django.middleware.clickjacking.XFrameOptionsMiddleware", 
        "django.middleware.locale.LocaleMiddleware", 
        "debug_toolbar.middleware.DebugToolbarMiddleware", 
        "myproject.apps.core.middleware.ThreadLocalMiddleware",
    ]
    ```

### å®ç°åŸç†...

ThreadLocalMiddlewareå¤„ç†æ¯ä¸ªè¯·æ±‚å¹¶å­˜å‚¨å½“å‰çº¿ç¨‹ä¸­çš„HttpRequestå¯¹è±¡ã€‚Djangoä¸­çš„æ¯ä¸ªè¯·æ±‚-å“åº”ç¯éƒ½æ˜¯å•çº¿ç¨‹çš„ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªå‡½æ•°get_current_request() å’Œ get_current_user()ã€‚è¿™ä¸¤ä¸ªå‡½æ•°å¯ç”¨åœ¨ä»»æ„åœ°æ–¹æ¥åˆ†åˆ«è·å–å½“å‰HttpRequestå¯¹è±¡æˆ–å½“å‰ç”¨æˆ·ã€‚

ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä¸­é—´ä»¶æ¥å¼€å‘ã€ä½¿ç”¨CreatorMixinï¼Œå®ƒä¼šä¿å­˜å½“å‰ç”¨æˆ·ä¸ºæ¨¡å‹å¯¹è±¡çš„åˆ›å»ºè€…ï¼Œå¦‚ä¸‹:

```
# myproject/apps/core/models.py
from django.conf import settings
from django.db import models
from django.utils.translation import gettext_lazy as _


class CreatorBase(models.Model): 
    """
    ract base class with a creator
    """

    creator = models.ForeignKey( 
        settings.AUTH_USER_MODEL, 
        verbose_name=_("creator"), 
        editable=False,
        blank=True,
        null=True,
        on_delete=models.SET_NULL, 
    )

    class Meta: 
        abstract = True
    
    def save(self, *args, **kwargs):
        from .middleware import get_current_user

        if not self.creator:
            self.creator = get_current_user()
        super().save(*args, **kwargs) 

    save.alters_data = True
```

### ç›¸å…³å†…å®¹

-   [**ç¬¬2ç«  æ¨¡å‹å’Œæ•°æ®åº“ç»“æ„**](https://alanhou.org/models-database-structure/)ä¸­çš„*é€šè¿‡URLç›¸å…³çš„æ–¹æ³•åˆ›å»ºæ¨¡å‹mixin*ä¸€èŠ‚
-   [**ç¬¬2ç«  æ¨¡å‹å’Œæ•°æ®åº“ç»“æ„**](https://alanhou.org/models-database-structure/)ä¸­çš„*åˆ›å»ºæ¨¡å‹mixinæ¥å¤„ç†åˆ›å»ºå’Œå˜æ›´æ—¥æœŸ*ä¸€èŠ‚
-   [**ç¬¬2ç«  æ¨¡å‹å’Œæ•°æ®åº“ç»“æ„**](https://alanhou.org/models-database-structure/)ä¸­çš„*åˆ›å»ºæ¨¡å‹mixinæ¥å¤„ç†å…ƒæ ‡ç­¾*ä¸€èŠ‚
-   [**ç¬¬2ç«  æ¨¡å‹å’Œæ•°æ®åº“ç»“æ„**](https://alanhou.org/models-database-structure/)ä¸­çš„*åˆ›å»ºæ¨¡å‹mixinæ¥å¤„ç†é€šç”¨å…³ç³»*ä¸€èŠ‚

## ä½¿ç”¨ä¿¡å·æ¥é€šçŸ¥ç®¡ç†å‘˜æ–°æ¡ç›®

Djangoæ¡†æ¶ä¸­æœ‰ä¸€ä¸ªä¿¡å·ï¼ˆsignalï¼‰çš„æ¦‚å¿µï¼Œç±»ä¼¼äºJavaScriptä¸­çš„äº‹ä»¶ã€‚æœ‰å¾ˆå¤šå†…ç½®çš„ä¿¡å·ã€‚å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥åœ¨æ¨¡å‹åˆå§‹åŒ–ã€ä¿å­˜æˆ–åˆ é™¤å®ä¾‹ã€è¿ç§»æ•°æ®åº“æ¨¡å¼æˆ–å¤„ç†è¯·æ±‚ç­‰ä¹‹å‰åŠä¹‹åè§¦å‘ä¸€äº›åŠ¨ä½œã€‚åŒæ—¶åœ¨å¯å¤ç”¨åº”ç”¨ä¸­å¯ä»¥åˆ›å»ºè‡ªå·±çš„ä¿¡å·æ¥åœ¨å…¶å®ƒåº”ç”¨ä¸­è¿›è¡Œå¤„ç†ã€‚æœ¬èŠ‚ä¸­æˆ‘ä»¬å­¦ä¹ å¦‚ä½•ä½¿ç”¨ä¿¡å·æ¥åœ¨ä¿å­˜æŒ‡å®šæ¨¡å‹æ—¶å‘ç®¡ç†å‘˜å‘é€é‚®ä»¶ã€‚

### å‡†å¤‡å·¥ä½œ

æˆ‘ä»¬é‡‡ç”¨*ä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢è¡¨è¾¾å¼*ä¸€èŠ‚ä¸­åˆ›å»ºçš„viral_videosåº”ç”¨ã€‚

### å¦‚ä½•å®ç°...

æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ¥ä¸ºç®¡ç†å‘˜åˆ›å»ºé€šçŸ¥ï¼š

1.  ä½¿ç”¨å¦‚ä¸‹å†…å®¹åˆ›å»ºæ–‡ä»¶signals.pyï¼š  


    ```
    # myproject/apps/viral_videos/signals.py
    from django.db.models.signals import post_save
    from django.dispatch import receiver
    from django.template.loader import render_to_string

    from .models import ViralVideo

    @receiver(post_save, sender=ViralVideo)
    def inform_administrators(sender, **kwargs): 
        from django.core.mail import mail_admins

        instance = kwargs["instance"] 
        created = kwargs["created"]
        
        if created:
            context = {"title": instance.title, "link": instance.get_url()} 
            subject = render_to_string(
                "viral_videos/email/administrator/subject.txt", context 
            )
            plain_text_message = render_to_string( 
                "viral_videos/email/administrator/message.txt", context
            )
            html_message = render_to_string(
                "viral_videos/email/administrator/message.html", 
                context
            )

            mail_admins( 
                subject=subject.strip(), 
                message=plain_text_message, 
                html_message=html_message, 
                fail_silently=True,
            )
    ```

1.  ç„¶åæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€äº›æ¨¡å‹ï¼Œå…ˆä»æ¨¡æ¿çš„emailä¸»é¢˜å¼€å§‹ï¼š  


    ```
    {# viral_videos/email/administrator/subject.txt #}
    New Viral Video Added
    ```

1.  ç„¶ååˆ›å»ºä¸€ä¸ªæ™®é€šæ–‡æœ¬æ¶ˆæ¯æ¨¡æ¿ï¼Œç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š  


    ```
    {# viral_videos/email/administrator/message.txt #}
    A new viral video called "{{ title }}" has been created. 
    You can preview it at {{ link }}.
    ```

1.  æ¥ç€å¯¹HTMLæ¶ˆæ¯åˆ›å»ºå¦‚ä¸‹æ¨¡æ¿ï¼š  


    ```
    {# viral_videos/email/administrator/message.html #}
    <p>A new viral video called "{{ title }}" has been created.</p> 
    <p>You can <a href="{{ link }}">preview it here</a>.</p>
    ```

1.  ä½¿ç”¨å¦‚ä¸‹å†…å®¹åˆ›å»ºæ–‡ä»¶apps.pyï¼š  


    ```
    # myproject/apps/viral_videos/apps.py
    from django.apps import AppConfig
    from django.utils.translation import ugettext_lazy as _

    class ViralVideosAppConfig(AppConfig): 
        name = "myproject.apps.viral_videos" 
        verbose_name = _("Viral Videos")

        def ready(self):
            from .signals import inform_administrators
    ```

1.  ä½¿ç”¨å¦‚ä¸‹å†…å®¹æ›´æ–°__init__.pyæ–‡ä»¶ï¼š  


    ```
    # myproject/apps/viral_videos/__init__.py
    default_app_config = "myproject.apps.viral_videos.apps.ViralVideosAppConfig"
    ```

    ç¡®ä¿åœ¨é¡¹ç›®é…ç½®æ–‡ä»¶ä¸­åƒå¦‚ä¸‹è¿™æ ·é…ç½®äº†ADMINSï¼š

    ```
    # myproject/settings/_base.py
    ADMINS = [("Administrator", "admin@example.com")]
    ```

### å®ç°åŸç†...

ViralVideosAppConfigé…ç½®ç±»ä¸­æœ‰ä¸€ä¸ªready()æ–¹æ³•ï¼Œåœ¨æ‰€æœ‰é¡¹ç›®æ¨¡å‹åŠ è½½åˆ°å†…å­˜ä¸­çš„æ—¶å€™ä¼šè¢«è°ƒç”¨ã€‚æ ¹æ®Djangoå®˜æ–¹æ–‡æ¡£ï¼Œä¿¡å·å…è®¸æŸäº›å‘é€è€…é€šçŸ¥ä¸€ç»„æ¥æ”¶è€…å‘ç”Ÿäº†æŸä¸€åŠ¨ä½œã€‚å› æ­¤åœ¨ready()æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥äº†inform_administrators()å‡½æ•°ã€‚

å€ŸåŠ©@receiverè£…é¥°å™¨ï¼Œå¯¹post_saveä¿¡å·æ³¨å†Œäº†inform_administrators()ï¼Œå¹¶ä¸”ä»…åœ¨å‘é€è€…ä¸ºViralVideoæ¨¡å‹æ—¶è¿›è¡Œè¯¥ä¿¡å·çš„å¤„ç†ã€‚å› æ­¤ï¼Œåœ¨è¿›è¡ŒViralVideoå¯¹è±¡ä¿å­˜æ—¶ï¼Œä¼šè°ƒç”¨æ¥æ”¶è€…å‡½æ•°ã€‚inform_administrators()å‡½æ•°æŸ¥çœ‹è§†é¢‘æ˜¯å¦ä¸ºæ–°å»ºçš„ã€‚å¦‚æ˜¯ï¼Œå®ƒä¼šå‘é…ç½®æ–‡ä»¶ä¸­ADMINSæ‰€åˆ—ä¸¾çš„ç³»ç»Ÿç®¡ç†å‘˜å‘é€é‚®ä»¶ã€‚

æˆ‘ä»¬ä½¿ç”¨æ¨¡å‹æ¥ç”Ÿæˆsubjectã€plain_text_messageä»¥åŠhtml_messageçš„å†…å®¹ï¼Œè¿™æ ·å¯ä»¥åœ¨åº”ç”¨ä¸­å¯¹å„è‡ªå®šä¹‰é»˜è®¤æ¨¡æ¿ã€‚å¦‚æœæŠŠviral_videosåº”ç”¨å¯¹å¤–å¼€æ”¾ï¼Œé‚£äº›åœ¨è‡ªå·±é¡¹ç›®ä¸­æ‹‰å–å®ƒçš„å¯ä»¥æŒ‰ç…§éœ€è¦å¯¹æ¨¡å‹è¿›è¡Œè‡ªå®šä¹‰ï¼Œæˆ–è®¸æ˜¯å°†å®ƒä»¬å°è£…åˆ°å…¬å¸é‚®ä»¶æ¨¡æ¿åŒ…è£…ä¸­å»ã€‚

> â„¹ï¸å¯åœ¨[å®˜æ–¹æ–‡æ¡£](https://docs.djangoproject.com/en/3.0/topics/signals/)ä¸­å­¦ä¹ æ›´å¤šæœ‰å…³Djangoä¿¡å·çš„çŸ¥è¯†ã€‚

### ç›¸å…³å†…å®¹

-   **[ç¬¬1ç«  Django 3.0å…¥é—¨](https://alanhou.org/getting-started-django3/)**ä¸­çš„*åˆ›å»ºåº”ç”¨é…ç½®*ä¸€èŠ‚
-   ä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢è¡¨è¾¾å¼ä¸€èŠ‚
-   *æ£€æµ‹ç¼ºå¤±çš„è®¾ç½®*ä¸€èŠ‚

## æ£€æµ‹ç¼ºå¤±çš„è®¾ç½®

ä»Django 1.7å¼€å§‹ï¼Œä½ å¯ä»¥ä½¿ç”¨å¯ç»§æ‰¿çš„ç³»ç»Ÿæ£€æµ‹æ¡†æ¶ï¼Œå®ƒæ›¿ä»£æ‰äº†è€çš„validateç®¡ç†å‘½ä»¤ã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åˆ›å»ºä¸€ä¸ªå¯¹ADMINSæ˜¯å¦å·²é…ç½®çš„æ£€æµ‹ã€‚ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æµ‹å¯†é’¥æˆ–æ‰€ä½¿ç”¨çš„APIçš„è¿æ¥tokenæ˜¯å¦è¿›è¡Œäº†è®¾ç½®ã€‚

### å‡†å¤‡å·¥ä½œ

æˆ‘ä»¬é‡‡ç”¨*ä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢è¡¨è¾¾å¼*ä¸€èŠ‚ä¸­åˆ›å»ºå¹¶åœ¨å‰é¢å°èŠ‚ä¸­è¿›è¡Œæ‰©å±•äº†çš„viral_videosåº”ç”¨æ¥å¼€å§‹æˆ‘ä»¬çš„å­¦ä¹ ã€‚

### å¦‚ä½•å®ç°...

æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ¥ä½¿ç”¨ç³»ç»Ÿæ£€æµ‹æ¡†æ¶ï¼š

1.  é€šè¿‡å¦‚ä¸‹å†…å®¹æ¥åˆ›å»ºæ–‡ä»¶checks.pyï¼š  


    ```
    # myproject/apps/viral_videos/checks.py
    from textwrap import dedent

    from django.core.checks import Warning, register, Tags

    @register(Tags.compatibility)
    def settings_check(app_configs, **kwargs):
        from django.conf import settings
        
        errors = []
        
        if not settings.ADMINS: 
        errors.append(
            Warning( dedent("""
                The system admins are not set in the project settings
            """), 
            obj=settings, 
            hint=dedent("""
                In order to receive notifications when new videos are created, define system admins in your settings, like:
                ADMINS = (
                    ("Admin", "administrator@example.com"),
                ) 
            """),
            id="viral_videos.W001", 
        )
                     )
        return errors
    ```

1.  åœ¨åº”ç”¨é…ç½®çš„ready()æ–¹æ³•ä¸­å¯¼å…¥è¿™ä¸€æ£€æµ‹ï¼Œå¦‚ä¸‹ï¼š  


    ```
    # myproject/apps/viral_videos/apps.py
    from django.apps import AppConfig
    from django.utils.translation import ugettext_lazy as _

    class ViralVideosAppConfig(AppConfig): 
        name = "myproject.apps.viral_videos" 
        verbose_name = _("Viral Videos")
        
        def ready(self):
            from .signals import inform_administrators 
            from .checks import settings_check
    ```

1.  æµ‹è¯•åˆšåˆšåˆ›å»ºçš„æ£€æµ‹ï¼Œåˆ é™¤æˆ–æ³¨é‡Šæ‰ADMINSé…ç½®ï¼Œç„¶ååœ¨è™šæ‹Ÿç¯å¢ƒä¸­è¿è¡Œcheckç®¡ç†å‘½ä»¤ï¼š  


    ```
    (env)$ python manage.py check
    System check identified some issues:
    WARNINGS:
    <Settings "myproject.settings.dev">: (viral_videos.W001) 
    The system admins are not set in the project settings
    HINT:
    In order to receive notifications when new videos are
    created, define system admins in your settings, like:
    ADMINS = (
        ("Admin", "administrator@example.com"),
    )

    System check identified 1 issue (0 silenced).
    ```

### å®ç°åŸç†...

ç³»ç»Ÿæ£€æµ‹æ¡†æ¶æœ‰ä¸€äº›æ¨¡å‹ã€å­—æ®µã€æ•°æ®åº“ã€ç®¡ç†è®¤è¯é…ç½®ã€å†…å®¹ç±»å‹å’Œå®‰å…¨é…ç½®çš„æ£€æµ‹ï¼Œå¦‚æœåœ¨é¡¹ç›®ä¸­æœªè¿›è¡Œæ­£ç¡®é…ç½®çš„è¯ä¼šæŠ¥å‡ºé”™è¯¯æˆ–è­¦å‘Šã€‚æ­¤å¤–ï¼Œå¯ä»¥åˆ›å»ºè‡ªæœ‰æ£€æµ‹ï¼Œç±»ä¼¼äºæœ¬èŠ‚ä¸­æ‰€åšçš„æ“ä½œã€‚

æˆ‘ä»¬æ³¨å†Œäº†settings_check()å‡½æ•°ï¼Œå¦‚æœåœ¨é¡¹ç›®ä¸­æœªå®šä¹‰ADMINSé…ç½®çš„è¯ä¼šè¿”å›ä¸€ä¸ªå¸¦æœ‰Warningçš„åˆ—è¡¨ã€‚

é™¤django.core.checksæ¨¡å—ä¸­çš„Warningå®ä¾‹å¤–ï¼Œè¿”å›åˆ—è¡¨ä¸­è¿˜å¯åŒ…å«Debugã€Infoã€Errorå’ŒCriticalå†…ç½®ç±»æˆ–å…¶å®ƒç»§æ‰¿è‡ªdjango.core.checks.CheckMessageçš„ç±»çš„å®ä¾‹ã€‚debugã€infoå’Œwarningçº§åˆ«çš„æ—¥å¿—ä¼šé™é»˜ç•¥è¿‡ï¼Œè€Œerrorå’Œcriticalçº§åˆ«çš„åˆ™ä¼šé˜»æ­¢é¡¹ç›®çš„è¿›ä¸€æ­¥æ‰§è¡Œã€‚

æœ¬ä¾‹ä¸­ï¼Œé€šè¿‡ä¼ é€’ç»™@registerè£…é¥°å™¨çš„Tags.compatibilityå‚æ•°æ¥ä¸ºæ£€æµ‹æ·»åŠ å…¼å®¹æ€§æ£€æµ‹çš„æ ‡è®°ã€‚Tagsæ‰€åŒ…å«çš„å…¶å®ƒé€‰é¡¹æœ‰ï¼š

-   adminç”¨äºåå°ç«™ç‚¹ç›¸å…³çš„æ£€æµ‹
-   cachesç”¨äºæœåŠ¡ç«¯ç¼“å­˜ç›¸å…³çš„æ£€æµ‹
-   databaseç”¨äºæ•°æ®åº“é…ç½®ç›¸å…³çš„æ£€æµ‹
-   modelsç”¨äºæ¨¡å‹ã€æ¨¡å‹å­—æ®µæˆ–ç®¡ç†å™¨ç›¸å…³çš„æ£€æµ‹
-   securityç”¨äºå®‰å…¨ç›¸å…³çš„æ£€æµ‹
-   signalsç”¨äºä¿¡å·å£°æ˜åŠå¤„ç†å™¨ç›¸å…³çš„æ£€æµ‹
-   staticfilesç”¨äºé™æ€æ–‡ä»¶æ£€æµ‹
-   templatesç”¨äºæ¨¡æ¿ç›¸å…³çš„æ£€æµ‹
-   translationç”¨äºå­—ç¬¦ä¸²ç¿»è¯‘ç›¸å…³çš„æ£€æµ‹
-   urlç”¨äºURLé…ç½®ç›¸å…³çš„æ£€æµ‹

> â„¹ï¸å‚è§[å®˜æ–¹æ–‡æ¡£](https://docs.djangoproject.com/en/3.0/topics/checks/)å­¦ä¹ æ›´å¤šæœ‰å…³ç³»ç»Ÿæ£€æµ‹æ¡†æ¶çš„çŸ¥è¯†ã€‚

### ç›¸å…³å†…å®¹

-   **[ç¬¬1ç«  Django 3.0å…¥é—¨](https://alanhou.org/getting-started-django3/)**ä¸­çš„*åˆ›å»ºåº”ç”¨é…ç½®*ä¸€èŠ‚
-   ä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢è¡¨è¾¾å¼ä¸€èŠ‚
-   *ä½¿ç”¨ä¿¡å·æ¥é€šçŸ¥ç®¡ç†å‘˜æ–°æ¡ç›®*ä¸€èŠ‚